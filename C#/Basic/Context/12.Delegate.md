# ëª©ì°¨

---

# Delegate

ë©”ì†Œë“œë¥¼ ì €ì¥í•˜ëŠ” ë°ì´í„° íƒ€ì…ì„ ì„ ì–¸í•˜ëŠ” í‚¤ì›Œë“œ

    `delegate {ë°˜í™˜íƒ€ì…} {Delegateì´ë¦„}({Parameter List})`

    í˜¸ì¶œ ì •ë³´, ë©”ì†Œë“œ ëª¨ì–‘, ì£¼ì†Œ ë“±ì„ ì €ì¥

()ì—°ì‚°ìë‚˜ invoke() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ì„œ ì§€ì •ëœ ë©”ì†Œë“œ í˜¸ì¶œ ê°€ëŠ¥

C/C++ì˜ í•¨ìˆ˜ í¬ì¸í„° ê°œë…ê³¼ ìœ ì‚¬í•˜ë‹¤.

```C#
delegate void FUNC(int arg);
/**/
    FUNC f = foo;
/**/
public static void foo(int arg)
{
    Console.WriteLine($"foo : {arg}");
}
```

# Delegate ì›ë¦¬

ìœ„ì™€ ê°™ì´ Delegateë¥¼ ì„ ì–¸í•˜ê²Œ ë˜ë©´ ì»´íŒŒì¼ëŸ¬ëŠ” ì•„ë˜ì™€ ê°™ì´ ë³€í™˜í•œë‹¤.

```C#
//delegate void FUNC(int arg);

//ì»´íŒŒì¼ëŸ¬ê°€ ì•„ë˜ì™€ ê°™ì´ ë³€í™˜

class FUNC : System.MulticastDelegate
{
    //....
}
```

C#ì—ì„œ classë¥¼ ìƒì„±í•  ê²½ìš° newë¥¼ í†µí•´ì„œ í• ë‹¹í•´ì¤€ë‹¤.

ê·¸ë ‡ê¸° ë–„ë¬¸ì— ìœ„ì˜ í‘œê¸°ë²•ê³¼ ë™ì¼í•˜ê²Œ í‘œê¸°í•´ì•¼ í•˜ë‚˜ ì•„ë˜ì™€ ê°™ì´ ì•”ì‹œì ìœ¼ë¡œ í—ˆìš©í•´ì¤€ë‹¤.

```C#
FUNC f1 = new FUNC(foo);    // ì •í™•í•œ í‘œê¸°ë²•
f1.Invoke(10);              //

FUNC f2 = foo;              // C#ë‚´ë¶€ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤Œ
f2(10);                     // f2.Invoke(10)
```

# Delegateê°€ ë©”ì„œë“œ ë“±ë¡í•˜ëŠ” ë°©ë²•

1. Static Method

   {ClassName.MethodName}

   ```C#
   public static void static_method(int arg) { }

   FUNC f1 = Test.static_method;
   //FUNC f2 = Program.static_method;
   FUNC f2 = static_method;
   ```

2. Instance Method

   ê°ì²´ ìƒì„± ì´í›„ ë“±ë¡ í•´ì•¼í•¨

   {Instance.MethodName}

   ```C#
   public void instance_method(int arg) { }

   /**/

   Test t = new Test();             //ê°ì²´  ìƒì„±
   FUNC f3 = t.instance_method;     //

   /**/

   public void foo()
   {
       FUNC f1 = this.instance_method;
       FUNC f2 = instance_method;
   }
   ```

# ìµëª… ë©”ì„œë“œ (Anonymous Method)

ë“±ë¡ë§Œ í•˜ë©´ êµ³ì´ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•  í•„ìš”ê°€ ì—†ë‹¤.

    - ìµëª… ë©”ì„œë“œ ì‚¬ìš©í•˜ë©´ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

        ```C#
        public static int Add(int a, int b) { return a + b; }
        /**/
        FUNC f = Add;
        ```

        ìœ„ì™€ ì•„ë˜ê°€ ë™ì¼í•¨

        ```C#
        FUNC f = delegate (int a, int b) { return a + b; };
        ```

        ì•„ë˜ ì½”ë“œëŠ” ì´ë¦„ì´ ì—†ê¸° ë–„ë¬¸ì— ìµëª… ë©”ì„œë“œë¼ê³  ë¶€ë¥¸ë‹¤.

# ë¸ë¦¬ê²Œì´íŠ¸ ì¸ìë¡œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```C#
public static void Main()
{
    FUNC f = delegate (int a, int b) { return a + b; };
    Foo(Add);                                           //3
    Foo(delegate (int a, int b) { return a - b; });     //-1
}

public static void Foo(FUNC f)
{
    Console.WriteLine(f(1, 2));
}
```

# Delegate Example

## ê³µí†µì„±ê³¼ ê°€ë³€ì„± ë¶„ë¦¬

    ë³€í•˜ì§€ ì•ŠëŠ” ì½”ë“œ ë‚´ì— ìˆëŠ” ë³€í•˜ëŠ” ì½”ë“œë¥¼ ë¶„ë¦¬ ì‹œí‚¨ë‹¤.

    ì•Œê³ ë¦¬ì¦˜ì€ ë³€ê²½ë˜ì§€ ì•Šê³  ì •ì±…(ê¸°ì¤€)ì´ ë³€ê²½ë  ê²½ìš°

    ë³€í•˜ëŠ” ë¶€ë¶„(ì •ì±…)ì„ í•¨ìˆ˜ ì¸ìë¡œ ë³€ê²½í•œë‹¤.

   <br>

ğŸ’¡ ì˜ˆì‹œ : ìë£Œêµ¬ì¡°ì˜ Sortì— 2ë²ˆì§¸ ì¸ìë¡œ ë¸ë¦¬ê²Œì´íŠ¸ë¥¼ ì¤€ë‹¤.

    ```C#
    public static void Sort(int[] arr, Comparison cmp)
    {
        int sz = arr.GetLength(0);

        for (int i = 0; i < sz - 1; i++)
        {
            for (int j = i + 1; j < sz; j++)
            {
                if (cmp(arr[i], arr[j]) > 0)
                    Swap(ref arr[i], ref arr[j]);
            }
        }
    }


    static void Main()
    {
        int[] x = { 1, 3, 5, 7, 9, 2, 4, 6, 8, 10 };

        Sort(x, delegate (int a, int b) { return a < b ? 1 : -1; });

        foreach (int n in x)
            Console.WriteLine(n);
    }
    ```

## ë‘ ìˆ˜ë¥¼ ë¹„êµí•˜ëŠ” ë©”ì†Œë“œë¥¼ ë‹´ì€ ì œë„¤ë¦­ ë¸ë¦¬ê²Œì´íŠ¸

ë¸ë¦¬ê²Œì´íŠ¸ ë˜í•œ ì œë„¤ë¦­ìœ¼ë¡œ êµ¬í˜„ ê°€ëŠ¥.

    ```C#
    delegate int Comparison<T>(T arg1, T arg2);

    /**/

    public static void Sort(int[] arr, Comparison<int> cmp)

    ```

ì´ë ‡ê²Œ í•˜ë©´ ëª¨ë“  ì¸ìì— ëŒ€í•œ ë¹„êµê°€ ê°€ëŠ¥í•˜ë‹¤.

# Delegate Chian

C#ì˜ ë¸ë¦¬ê²Œì´íŠ¸ëŠ” ê²°í•©ì´ ëœë‹¤.

    1. Combineì„ í†µí•´ì„œ ê²°í•© í•  ìˆ˜ ìˆë‹¤.

        ê°€ë³€ ê¸¸ì´ë¡œ êµ¬í˜„ë˜ì–´ ìˆìŒ

        â— Delegateê°€ ì•„ë‹Œ ë©”ì„œë“œëŠ” ë“¤ì–´ê°ˆ ìˆ˜ ì—†ìŒ!.

        ```C#
        //1. Delegate.Combine()
        FUNC f4 = (FUNC)Delegate.Combine(f1, f2);
        FUNC f4 = (FUNC)Delegate.Combine(f1, f2, f3);
        //FUNC f4 = (FUNC)Delegate.Combine(f1, Test.Method4); //error
        ```

    2. +, -ë„ ê°€ëŠ¥í•˜ë‹¤.

        ì´ê²ƒ ë˜í•œ ì—¬ëŸ¬ê°œ ê°€ëŠ¥í•˜ë‹¤.

        ë©”ì„œë“œë„ ì‚½ì… ê°€ëŠ¥!!

        ```C#
        //2. +, -, += , -=
        FUNC f5 = f1 + f2 + f3;
        FUNC f5 = f1 + Test.Method4 + f2;       //ok!
        f5();
        ```

    3. Delegate ëŠ” Immutable í•˜ë‹¤.

        Stringì™€ ë™ì¼í•˜ê²Œ ìˆ˜ì •ì‹œ ìƒˆë¡œìš´ ê°ì²´ê°€ ìƒì„±ëœë‹¤.

        ```C#
        FUNC f6 = Test.Method1;
        FUNC f7 = f6;
        Console.WriteLine(f6 == f7);// true

        f6 += Test.Method2;// f6 = f6 + Test.Method2;
                           // f6 = new FUNC(  ... )

        Console.WriteLine(f6 == f7); // false
        ```

<br>

## Delegate Get Chian Value

ë©€í‹° ì¼€ìŠ¤íŠ¸ ë¸ë¦¬ê²Œì´íŠ¸ì—ì„œ ê°’ì„ ì–»ì–´ì˜¤ë©´ ì œì¼ ë§ˆì§€ë§‰ ë“±ë¡í•œ ë°˜í™˜ê°’ë§Œ ì–»ê²Œ ëœë‹¤.

    -> {delegate}.GetInvocationList() ì‚¬ìš©

        ë“±ë¡ëœ ëª¨ë“  ë¸ë¦¬ê²Œì´íŠ¸ë¥¼ ë°˜í™˜í•œë‹¤.

```C#

/* MethodN ì„ ì–¸ ë°˜í™˜ìœ¼ë¡œ N */

delegate int FUNC();

public static void Main()
{
    FUNC uni = Test.Method1;

    int ret1 = uni();
    Console.WriteLine(ret1); // 1

    FUNC multi = Test.Method1;
    multi += Test.Method2;
    multi += Test.Method3;
    multi += Test.Method4;

    int ret2 = multi();
    Console.WriteLine(ret2); // 4 ê°€ì¥ ë§ˆì§€ë§‰ ê²ƒì´ ë°˜í™˜ë¨.

    //-------------------------
    //ëª¨ë“  ê°’ì„ ì–»ê³  ì‹¶ì„ë•Œ

    //GetInvocationList = ëª¨ë“  ë¸ë¦¬ê²Œì´íŠ¸ ë°°ì—´ë¡œ ë°˜í™˜ë¨

    Delegate[] arr = multi.GetInvocationList();

    //ë£¨í”„ ëŒë©´ì„œ ì „ë¶€ ë°˜í™˜
    foreach( Delegate d in arr)
    {
        FUNC f = (FUNC)d;
        int ret3 = f();
        Console.WriteLine(ret3);            // ê°ê° í•˜ë‚˜ì”© ìˆœíšŒí•¨.
    }
}
```
