# ëª©ì°¨

<br>

---

# Task

| --                  | Thread í´ë˜ìŠ¤ | ThreadPool |
| ------------------- | ------------- | ---------- |
| ì¢…ë£Œ ëŒ€ê¸°           | â­•            | âŒ         |
| ìŠ¤ë ˆë“œ ë°˜í™˜ ê°’ ì–»ê¸° | âŒ            | âŒ         |
| ì—°ì† ì‹¤í–‰           | âŒ            | âŒ         |

ğŸ’¡ Thread ì¢…ë£Œ ëŒ€ê¸°ëŠ” `t1.Join()`ì„ í†µí•´ì„œ ê°€ëŠ¥í•˜ë‹¤.

- ThreadëŠ” ê´€ë¦¬í•˜ê¸° ë¶ˆí¸í•œ ì ì´ ë§ë‹¤.

  ê·¸ë˜ì„œ C#ì€ taskì„ ì§€ì›í•œë‹¤.

| --                 | Task            | Task<T>          |
| ------------------ | --------------- | ---------------- |
| ë°˜í™˜ê°’ ì—¬ë¶€        | âŒ              | â­•               |
| ìˆ˜í–‰í•  ë©”ì„œë“œ ëª¨ì–‘ | Action          | Func<T>          |
| ìˆ˜í–‰í•  ë©”ì„œë“œ ëª¨ì–‘ | Action<object?> | Func<object?, T> |

<br>

Taskí´ë˜ìŠ¤ë¡œ Threadìƒì„±í•˜ëŠ” ë°©ë²•

- `new Task(F1).Start()`

- `Task.Run(F1)`

  ë‹¨ ì¸ìê°€ ì—†ëŠ” ë©”ì„œë“œë§Œ ê°€ëŠ¥.

  => ëŒë‹¤ í‘œí˜„ì‹ ì‚¬ìš©.

<br>

TaskëŠ” Thread Poolì—ì„œ Threadë¥¼ ëŒì–´ì™€ì„œ ì‚¬ìš©í•œë‹¤.

```C#
using System;
using System.Threading;
using System.Threading.Tasks;

class Program
{
    static void F1()
    {
        Console.WriteLine(Thread.CurrentThread.IsThreadPoolThread);
        Console.WriteLine(Thread.CurrentThread.IsBackground);
    }

    public static void Maind()
    {
        Task t1 = new Task(F1);
        // Task t1 = new Task(F1, TaskCreationOptions.LongRunning);
        //í•´ë‹¹ ì˜µì…˜ì„ ì£¼ê²Œ ë˜ë©´ poolingí•˜ì§€ ì•Šê³  ìƒˆë¡œ ë§Œë“¤ì–´ ì“´ë‹¤.

        t1.Start();
        Task t2 = Task.Run(F1);
    }
}

```

ì¶œë ¥ê°’ì„ í™•ì¸í•˜ë©´ true, trueê°€ ë‚˜ì˜¤ëŠ”ë°

ì•„ë˜ ì¤„ì¸ `new Task(F1, TaskCreationOptions.LongRunning);` í•˜ê²Œ ë˜ë©´ false, true ì¦‰ poolì—ì„œ êº¼ë‚´ì§€ ì•ŠëŠ”ë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ Runì€ Task Poolì—ì„œ êº¼ë‚´ì˜¤ë©° Poolì—ì„œ êº¼ë‚´ê¸° ì‹«ì„ ê²½ìš° ì§ì ‘ ë§Œë“¤ì–´ ì¤˜ì•¼ í•œë‹¤.

# Task ì—°ì† ì‹¤í–‰

ì£¼ ì“°ë ˆë“œê°€ GUIì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬ì¤‘ì´ë¼ê³  ê°€ì • í•  ê²½ìš° Blockingì´ ë°œìƒ í•˜ë©´ ì•ˆëœë‹¤.

Aë¼ëŠ” ì“°ë ˆë“œë¥¼ ë§Œë“¤ì—ˆì„ë•Œ, í•´ë‹¹ ì—°ì‚°ì„ ê°€ì§€ê³  ìƒˆë¡œìš´ ì“°ë ˆë“œë¥¼ ë§Œë“¤ì–´ì„œ ìƒˆë¡œìš´ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ê³  ì‹¶ì„ë•Œ?

`{í…ŒìŠ¤í¬ ì¸ìŠ¤í„´ìŠ¤}.ContinueWith({ë©”ì„œë“œ})` ë¥¼ í†µí•´ ê°€ëŠ¥í•˜ë‹¤.

    call Backê³¼ ìœ ì‚¬

```C#
using System;
using System.Threading;
using System.Threading.Tasks;

class Program
{
    static int Sum(int cnt)
    {
        int s = 0;
        for (int i = 0; i <= cnt; i++) s += i;
        return s;
    }

    public static void Foo(Task<int> t)
    {
        Console.WriteLine(t.Result);
    }

    public static void Main()
    {
        Task<int> t = Task.Run(() => Sum(1000));

        t.ContinueWith(Foo);

        Console.ReadLine();
    }
}
```

- taskëŠ” ì—°ì†ìœ¼ë¡œ ë“±ë¡ ê°€ëŠ¥í•˜ë‹¤.

  ```C#
  t.ContinueWith(Foo);
  t.ContinueWith(Goo);
  ```

- taskëŠ” ëŒë‹¤ ë“±ë¡ì´ ëœë‹¤. (ì¸ìëŠ” task)

  ```C#
  t.ContinueWith(Foo);
  t.ContinueWith(Goo);
  t.ContinueWith(task => Console.WriteLine("Lamda")));
  ```

- ìœ„ì™€ ê°™ì´ Fooì™€ Gooë¥¼ ì—°ì†ìœ¼ë¡œ ë“±ë¡ í•  ê²½ìš° í’€ì— ìˆëŠ” Qì˜ ì˜ˆìƒë˜ëŠ” ëª¨ì–‘ì€ ì•„ë˜ì™€ ê°™ë‹¤.

  | Queue |
  | ----- |
  | Sum   |
  | Foo   |
  | Goo   |

  í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ì•„ë˜ì™€ ê°™ì´ ëœë‹¤.

  | Queue |
  | ----- |
  | Sum   |

  ì´í›„ì— Sumì´ ëë‚  ê²½ìš° Fooì™€ Goo ë©”ì„œë“œë¥¼ Queueì— ë„£ê²Œ ëœë‹¤.

  ğŸ’¡ ContinueWithëŠ” í•´ë‹¹ í•¨ìˆ˜ê°€ ëë‚˜ë©´ Queueì— ë„£ëŠ”ë‹¤.

  - Sumì„ ìˆ˜í–‰í•œ ìŠ¤ë ˆë“œê°€ Foo,Gooë¥¼ ìˆ˜í–‰í• ìˆ˜ë„ ìˆê³  ì•„ë‹ ìˆ˜ë„ ìˆë‹¤.

    í•œ ìŠ¤ë ˆë“œê°€ ì—°ì†ìœ¼ë¡œ ì‘ì—… ìˆ˜í–‰ì‹œí‚¤ê³  ì‹¶ì„ ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ì§œë©´ ëœë‹¤.

    ```C#
    t.ContinueWith(Foo, TaskContinuationOptions.ExecuteSynchronously);
    ```

## Awaiter

Taskë¥¼ ì—°ì† í• ë‹¹ í• ë•Œ Awaiterì„ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

```C#
public static void Main()
{
    Task<int> t = Task.Run(() => Sum(1000));

    t.ContinueWith(task => Console.WriteLine($"{task.Result}"));

    TaskAwaiter<int> awaiter = t.GetAwaiter();
    awaiter.OnCompleted(() => Console.WriteLine($"{awaiter.GetResult()}"));

    Console.ReadLine();
}
```

<br>

|          | Task                  | Awaiter                 |
| -------- | --------------------- | ----------------------- |
| ëŒë‹¤ì¸ì | Taskë¥¼ ì¸ìë¡œ ê°€ì§„ë‹¤. | ì¸ìê°€ ì—†ë‹¤             |
| ê²°ê³¼ê°’   | `{Task}.Result`       | `{awaiter}.GetResult()` |
