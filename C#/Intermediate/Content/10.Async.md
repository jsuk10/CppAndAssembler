# ëª©ì°¨

<br>

---

# ë¹„ë™ê¸° í•¨ìˆ˜

ì½”ë£¨í‹´ê³¼ ë¹„ìŠ·í•˜ê²Œ ì¼ë°˜ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë‹¤ê°€ íŠ¹ì • ì‹œì ì— ë™ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤.

ì“°ë ˆë“œë¥¼ ì—¬ëŸ¬ê°œ ëŒë ¤ì„œ í•¨ìˆ˜ê°€ ê°™ì´ ì‹¤í–‰ë˜ëŠ” ê°œë…ìœ¼ë¡œ ìƒê°í•˜ë©´ ëœë‹¤.

- ì˜¤ëœ ì‹œê°„ì´ ì†Œìš”ë˜ëŠ” ì‘ì—…ì„ í•  ë•Œ ì‚¬ìš©ëœë‹¤.

- ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” ì‘ì—…ì´ ì¢…ë£Œë¨ì„ ë³´ì¥ í•  ìˆ˜ ì—†ë‹¤.

  ì‘ì—… ì¢…ë£Œë¥¼ í™•ì¸í•˜ê³  ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

C# ì—ì„œëŠ” 2ê°€ì§€ë¡œ ë³¼ ìˆ˜ ìˆë‹¤.

1. ì¼ë°˜ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜

   CPUì‚¬ìš©

2. ì…ì¶œë ¥ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜

   ì…ì¶œë ¥ì„ ëŒ€ê¸° í•´ì•¼ í•œë‹¤.

---

ì–´ë– í•œ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì¼ì„ ìˆ˜í–‰ í•˜ë ¤ëŠ”ë° Blockingë¥¼ ë‹¹í•˜ê³  ì‹¶ì§€ ì•Šì€ ê²½ìš°

```C#
public static int Sum(int first, int last)
{
    int s = 0;
    for (int i = first; i <= last; i++)
    {
        s += i;
        Thread.Sleep(10);
    }
    return s;
}
```

1. Threadì‚¬ìš© í•œë‹¤.

   ```C#
   Task<int> t = Task.Run(() => Sum(1, 200));          // ë¹„ë™ê¸° ë°©ë²• 1
   ```

2. ë©”ì„œë“œ ìì²´ë¥¼ ë¹„ë™ê¸°ë¡œ ë§Œë“ ë‹¤.

   ```C#
    public static Task<int> SumAsync(int first, int last)
    {
        Task<int> t = Task.Run(() =>
        {
            int s = 0;
            for (int i = first; i <= last; i++)
            {
                s += i;
                Thread.Sleep(10);
            }
            return s;
        });
        return t;
    }
   ```

<br>

---

# Async & Await

ìœ„ì˜ ì½”ë“œì—ì„œ ë¬¸ì œì .

- SumAsyncë©”ì„œë“œëŠ” ë¹„ë™ê¸° ë©”ì„œë“œì´ë¯€ë¡œ Blockingë˜ì§€ ì•ŠëŠ”ë‹¤.

  í•˜ì§€ë§Œ ê²°ê³¼ê°’ì„ ì–»ê¸° ìœ„í•´ Blockingê°€ ë°œìƒí•œë‹¤.

ğŸ’¡ ë°©ë²•

1. Taskì—°ì† ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ê°’ì„ ì–»ê¸° ìœ„í•´ Blockingë˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤.
2. {task}.ContunueWith() ë˜ëŠ” t.GetAwaiter()ì„ ì‚¬ìš©í•œë‹¤.

```C#
public static void UpdateResult()
{

    Task<int> t = SumAsync(1, 200);
    //Console.WriteLine($"{t.Result}");         //ì—¬ê¸°ì„œ blockingë°œìƒí•¨.
    var awaiter = t.GetAwaiter();

    awaiter.OnCompleted( () =>
        Console.WriteLine($"{awaiter.GetResult()}"));
}
```

ìœ„ì˜ ê¸°ëŠ¥ì„ ë” í¸í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ Async & Awaitê°€ ì¶œí˜„ í–ˆë‹¤.

ìœ„ì˜ ì½”ë“œì™€ ì•„ë˜ì˜ ì½”ë“œì™€ ë™ì¼í•˜ë‹¤.

- AwaitëŠ” ë™ê¸° í•¨ìˆ˜ì´ë‚˜ ë¹„ë™ê¸° êµ¬ë¬¸ì²˜ëŸ¼ ì‘ì„± ê°€ëŠ¥í•˜ë‹¤.

- í•¨ìˆ˜ì˜ ë°˜í™˜ê°’ì•ì— asyncë¥¼ ë¶™ì—¬ì¤˜ì•¼ í•œë‹¤.

- awaitë¥¼ ë§Œë‚˜ë©´ ì£¼ ìŠ¤ë ˆë“œëŠ” ë‚˜ë¨¸ì§€ ë¶€ë¶„ì„ ê±´ë„ˆë›°ê³  íƒˆì¶œí•œë‹¤.

  ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ í˜¸ì¶œì´ ëë‚˜ë©´ Thread Pool ì—ì„œ Threadê°€ ì‹¤í–‰í•œë‹¤.

```C#
public static async void UpdateResult() //awitë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ asyncì‚¬ìš©
{
    int ret = await SumAsync(1, 200); // awaitë¥¼ í†µí•´ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë™ê¸° í•¨ìˆ˜ ì²˜ëŸ¼ ì‚¬ìš©

    Console.WriteLine($"{ret}");
}
```

ìœ„ì˜ ìŠ¤ë ˆë“œì˜ ì¢…ë£Œë¥¼ ëŒ€ê¸°í•˜ê³  ì‹¶ì€ ê²½ìš° `await()`ë¥¼ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

- í•¨ìˆ˜ë¥¼ void ì—ì„œ Taskë¡œ ë³€ê²½í•´ì•¼ í•œë‹¤.

```C#
public static async Task UpdateResult()
{
    int ret = await SumAsync(1, 200);

    Console.WriteLine($"{ret}");
}


public static void Main()
{
    Task<int> t = UpdateResult();

    t.Wait();

    Console.WriteLine("Main : Run Event Loop");
    Console.ReadLine();
}
```

ë°˜í™˜ê°’ì„ ë°›ê³  ì‹¶ì€ ê²½ìš° Task<T>ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```C#
public static async Task<int> UpdateResult()
{
    int ret = await SumAsync(1, 200);

    Console.WriteLine($"{ret}");
    return ret;                                 //await ê°€ int íƒ€ì…ì„ ìë™ìœ¼ë¡œ ë³€ê²½í•´ì¤Œ
}


public static void Main()
{
    Task<int> t = UpdateResult();

    Console.WriteLine($"Main : {t.Result}");    // ì¼ë°˜ Taskì²˜ëŸ¼ ëŒ€ê¸°


    Console.WriteLine("Main : Run Event Loop");
    Console.ReadLine();
}
```

ğŸ’¡ Async / await ë¡œ ë¹„ë™ê¸° í•¨ìˆ˜ ë§Œë“¤ê¸°

- ë°˜í™˜ íƒ€ì… ì•ì— async ë¥¼ ë¶™ì¸ë‹¤.

  ```C#
  public static async void UpdateResult()
  {
      //...

      int ret = await SumAsync(1, 200);

      Console.WriteLine($"{ret}");
  }
  ```

- ë°˜í™˜ íƒ€ì…ì€ `void`, `Task`, `Task<T>` ê°€ ë  ìˆ˜ ìˆìœ¼ë©°, `Task<T>`ì¼ ê²½ìš°ì— `retrun`ë¬¸ì´ í•„ìš”í•˜ë‹¤

<br>

---

# IOì™€ ë¹„ë™ê¸° í•¨ìˆ˜

IOëŠ” ì•„ë˜ì™€ ê°™ì€ ê³¼ì •ìœ¼ë¡œ ì´ë£¨ì–´ ì§„ë‹¤.

| í˜¸ì¶œ ìˆœì„œ      | ë¹„ê³                   |
| -------------- | --------------------- |
| C#í•¨ìˆ˜ í˜¸ì¶œ    | í•¨ìˆ˜ í˜¸ì¶œ             |
| Win APIí˜¸ì¶œ    | í•¨ìˆ˜ í˜¸ì¶œ             |
| OS ì˜ì—­        | í•¨ìˆ˜ í˜¸ì¶œ             |
| Hard Ware ì˜ì—­ | ì‹œê°„ì´ ë§¤ìš° ì˜¤ë˜ ê±¸ë¦¼ |

Hard Ware ì˜ì—­ì—ì„œ ì‹œê°„ì´ ë§¤ìš° ì˜¤ë˜ ê±¸ë¦¬ê¸° ë•Œë¬¸ì— ì‘ì—… ìš”ì²­ë§Œ í•˜ê³  í•¨ìˆ˜ê°€ ë°”ë¡œ ë°˜í™˜í•œë‹¤ë©´ Blockingì„ ê±¸ë¦¬ì§€ ì•ŠëŠ”ë‹¤.

```C#
fs.Write();         // íŒŒì¼ì— ì“°ëŠ” ì‘ì—…ì„ ë™ê¸°ë¡œ í˜¸ì¶œ

fs.WriteAsync();    // ì“°ê¸° ì‘ì—…ì„ ìš”ì²­í•œ ë’¤ì— ì¦‰ì‹œ ë°˜í™˜.
```

- WriteAsync

  ì“°ê¸° ì‘ì—…ì„ ìš”ì²­í›„ ì¦‰ì‹œ ë°˜í™˜

  ì“°ê¸° ì‘ì—… ì¢…ë£Œì‹œ í’€ì— í†µë³´í•¨.

```C#
using System;
using System.IO;

class Program
{

    //ë™ê¸°
    public static void WriteSync()
    {
        using (FileStream fs = new FileStream("a.txt", FileMode.Create))
        {
            byte[] buff = new byte[1024 * 1024 * 1000]; // 1G

            fs.Write(buff); //  ë™ê¸°ì ìœ¼ë¡œ ì“°ê¸°

            Console.WriteLine("WriteSync Finish");
        }
    }

    //ë¹„ë™ê¸°
    public static async void WriteAsync()
    {
        using (FileStream fs = new FileStream("a.txt", FileMode.Create))
        {
            byte[] buff = new byte[1024 * 1024 * 1000]; // 1G

            await fs.WriteAsync(buff);                  // io ì¢…ë£Œê¹Œì§€ ëŒ€ê¸°

            Console.WriteLine("WriteAsync Finish");
        }
    }


    public static void Main()
    {
        //WriteSync();
        WriteAsync();
        Console.WriteLine("Main");
        Console.ReadLine();
    }
}

```

# ì •ë¦¬

| ê³„ì‚° ì¤‘ì‹¬ì˜ ë¹„ë™ê¸° í•¨ìˆ˜        | ì…ì¶œë ¥(I/O) ì¤‘ì‹¬ì˜ ë¹„ë™ê¸° í•¨ìˆ˜       |
| ------------------------------ | ------------------------------------ |
| ìƒˆë¡œìš´ ì“°ë ˆë“œì— ì˜í•´ ì—°ì‚° ìˆ˜í–‰ | ë¹„ë™ê¸° ì…ì¶œë ¥ ì‘ì—… ìˆ˜í–‰ í›„ OSì— í†µë³´ |
